!function(){function r(r,o){if(!t)var t={map:function(r,o){var t={};return o?r.map(function(r,e){return t.index=e,o.call(t,r)}):r.slice()},naturalOrder:function(r,o){return o>r?-1:r>o?1:0},sum:function(r,o){var t={};return r.reduce(o?function(r,e,n){return t.index=n,r+o.call(t,e)}:function(r,o){return r+o},0)},max:function(r,o){return Math.max.apply(null,o?t.map(r,o):r)}};var e=function(){function r(r,o,t){return(r<<2*c)+(o<<c)+t}function o(r){function o(){t.sort(r),e=!0}var t=[],e=!1;return{push:function(r){t.push(r),e=!1},peek:function(r){return e||o(),void 0===r&&(r=t.length-1),t[r]},pop:function(){return e||o(),t.pop()},size:function(){return t.length},map:function(r){return t.map(r)},debug:function(){return e||o(),t}}}function e(r,o,t,e,n,i,a){var u=this;u.r1=r,u.r2=o,u.g1=t,u.g2=e,u.b1=n,u.b2=i,u.histo=a}function n(){this.vboxes=new o(function(r,o){return t.naturalOrder(r.vbox.count()*r.vbox.volume(),o.vbox.count()*o.vbox.volume())})}function i(o){var t,e,n,i,a=1<<3*c,u=new Array(a);return o.forEach(function(o){e=o[0]>>v,n=o[1]>>v,i=o[2]>>v,t=r(e,n,i),u[t]=(u[t]||0)+1}),u}function a(r,o){var t,n,i,a=1e6,u=0,s=1e6,c=0,f=1e6,p=0;return r.forEach(function(r){t=r[0]>>v,n=r[1]>>v,i=r[2]>>v,a>t?a=t:t>u&&(u=t),s>n?s=n:n>c&&(c=n),f>i?f=i:i>p&&(p=i)}),new e(a,u,s,c,f,p,o)}function u(o,e){function n(r){var o,t,n,i,a,u=r+"1",s=r+"2",v=0;for(c=e[u];c<=e[s];c++)if(g[c]>h/2){for(n=e.copy(),i=e.copy(),o=c-e[u],t=e[s]-c,a=t>=o?Math.min(e[s]-1,~~(c+t/2)):Math.max(e[u],~~(c-1-o/2));!g[a];)a++;for(v=d[a];!v&&g[a-1];)v=d[--a];return n[s]=a,i[u]=n[s]+1,[n,i]}}if(e.count()){var i=e.r2-e.r1+1,a=e.g2-e.g1+1,u=e.b2-e.b1+1,s=t.max([i,a,u]);if(1==e.count())return[e.copy()];var c,v,f,p,l,h=0,g=[],d=[];if(s==i)for(c=e.r1;c<=e.r2;c++){for(p=0,v=e.g1;v<=e.g2;v++)for(f=e.b1;f<=e.b2;f++)l=r(c,v,f),p+=o[l]||0;h+=p,g[c]=h}else if(s==a)for(c=e.g1;c<=e.g2;c++){for(p=0,v=e.r1;v<=e.r2;v++)for(f=e.b1;f<=e.b2;f++)l=r(v,c,f),p+=o[l]||0;h+=p,g[c]=h}else for(c=e.b1;c<=e.b2;c++){for(p=0,v=e.r1;v<=e.r2;v++)for(f=e.g1;f<=e.g2;f++)l=r(v,f,c),p+=o[l]||0;h+=p,g[c]=h}return g.forEach(function(r,o){d[o]=h-r}),n(s==i?"r":s==a?"g":"b")}}function s(r,e){function s(r,o){for(var t,e=1,n=0;f>n;)if(t=r.pop(),t.count()){var i=u(c,t),a=i[0],s=i[1];if(!a)return;if(r.push(a),s&&(r.push(s),e++),e>=o)return;if(n++>f)return}else r.push(t),n++}if(!r.length||2>e||e>256)return!1;var c=i(r),v=0;c.forEach(function(){v++});var l=a(r,c),h=new o(function(r,o){return t.naturalOrder(r.count(),o.count())});h.push(l),s(h,p*e);for(var g=new o(function(r,o){return t.naturalOrder(r.count()*r.volume(),o.count()*o.volume())});h.size();)g.push(h.pop());s(g,e-g.size());for(var d=new n;g.size();)d.push(g.pop());return d}var c=5,v=8-c,f=1e3,p=.75;return e.prototype={volume:function(r){var o=this;return(!o._volume||r)&&(o._volume=(o.r2-o.r1+1)*(o.g2-o.g1+1)*(o.b2-o.b1+1)),o._volume},count:function(o){var t=this,e=t.histo;if(!t._count_set||o){var n,i,a,u=0;for(n=t.r1;n<=t.r2;n++)for(i=t.g1;i<=t.g2;i++)for(a=t.b1;a<=t.b2;a++)index=r(n,i,a),u+=e[index]||0;t._count=u,t._count_set=!0}return t._count},copy:function(){var r=this;return new e(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},avg:function(o){var t=this,e=t.histo;if(!t._avg||o){var n,i,a,u,s,v=0,f=1<<8-c,p=0,l=0,h=0;for(i=t.r1;i<=t.r2;i++)for(a=t.g1;a<=t.g2;a++)for(u=t.b1;u<=t.b2;u++)s=r(i,a,u),n=e[s]||0,v+=n,p+=n*(i+.5)*f,l+=n*(a+.5)*f,h+=n*(u+.5)*f;t._avg=v?[~~(p/v),~~(l/v),~~(h/v)]:[~~(f*(t.r1+t.r2+1)/2),~~(f*(t.g1+t.g2+1)/2),~~(f*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(r){var o=this,t=r[0]>>v;return gval=r[1]>>v,bval=r[2]>>v,t>=o.r1&&t<=o.r2&&gval>=o.g1&&gval<=o.g2&&bval>=o.b1&&bval<=o.b2}},n.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var o=this.vboxes,t=0;t<o.size();t++)if(o.peek(t).vbox.contains(r))return o.peek(t).color;return this.nearest(r)},nearest:function(r){for(var o,t,e,n=this.vboxes,i=0;i<n.size();i++)t=Math.sqrt(Math.pow(r[0]-n.peek(i).color[0],2)+Math.pow(r[1]-n.peek(i).color[1],2)+Math.pow(r[2]-n.peek(i).color[2],2)),(o>t||void 0===o)&&(o=t,e=n.peek(i).color);return e},forcebw:function(){var r=this.vboxes;r.sort(function(r,o){return t.naturalOrder(t.sum(r.color),t.sum(o.color))});var o=r[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(r[0].color=[0,0,0]);var e=r.length-1,n=r[e].color;n[0]>251&&n[1]>251&&n[2]>251&&(r[e].color=[255,255,255])}},{quantize:s}}();return e.quantize(r,o)}function o(){var r=765,o=7,t=r/o;return{MAX_BRIGHTNESS:765,VERY_DARK:1*t,DARK:2*t,BRIGHT:3*t,VERY_BRIGHT:4*t}}var t={version:"0.6.0"};t._support={},t._support.toColorObj=function(r){var o={};return o.r=r[0],o.g=r[1],o.b=r[2],o},t._support.CanvasImage=function(r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=r.width,this.height=this.canvas.height=r.height,this.context.drawImage(r,0,0,this.width,this.height)},t._support.CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t._support.CanvasImage.prototype.update=function(r){this.context.putImageData(r,0,0)},t._support.CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},t._support.CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},t._support.CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)},t.algorithms={},t.algorithms.quantize=function(o,t){return r(o,t)},t.video={},t.video._hasPermission=!1,t.video._listenerQueue=[],t.video.onPermission=function(r){t.video._hasPermission?r.call():t.video._listenerQueue.push(r)},t.video.gotPermission=function(){if(t.video._hasPermission=!0,t.video._listenerQueue){for(var r,o=0;r=t.video._listenerQueue[o++];)r.call();t.video._listenerQueue=null}},t.video.register=function(r){var o=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)};if(!o())throw new Error("init(): Sorry, your browser does not support this behaviour");var e={video:!0},n=function(r){console.error("Video capture error: ",r)};navigator.getUserMedia?navigator.getUserMedia(e,function(o){r.src=o,r.play(),t.video.gotPermission()},n):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e,function(o){r.src=window.webkitURL.createObjectURL(o),r.play(),t.video.gotPermission()},n):navigator.mozGetUserMedia&&navigator.mozGetUserMedia(e,function(o){r.src=window.URL.createObjectURL(o),r.play(),t.video.gotPermission()},n)},t.video.isVeryDark=function(r){var e=o(),n=t.video.color.dominantColor(r);n=t._support.toColorObj(n);var i=n.r+n.g+n.b;return i<=e.VERY_DARK?!0:!1},t.video.isDark=function(r){var e=o(),n=t.video.color.dominantColor(r);n=t._support.toColorObj(n);var i=n.r+n.g+n.b;return i>e.VERY_DARK&&i<=e.DARK?!0:!1},t.video.isBright=function(r){var e=o(),n=t.video.color.dominantColor(r);n=t._support.toColorObj(n);var i=n.r+n.g+n.b;return i>=e.DARK&&i<e.BRIGHT?!0:!1},t.video.isVeryBright=function(r){var e=o(),n=t.video.color.dominantColor(r);n=t._support.toColorObj(n);var i=n.r+n.g+n.b;return i>=e.BRIGHT?!0:!1},t.video.getBrightness=function(r){var e=o(),n=t.video.color.dominantColor(r,5);n=t._support.toColorObj(n);var i=n.r+n.g+n.b;return i/e.MAX_BRIGHTNESS},t.video.getPixels=function(r){var o=new t._support.CanvasImage(r),e=o.getImageData(),n=e.data;return o.removeCanvas(),n},t.video.getPixelCount=function(r){var o=new t._support.CanvasImage(r);return o.removeCanvas(),o.getPixelCount()},t.video.color={},t.video.color.colorPalette=function(r,o,e){"undefined"==typeof o&&(o=10),"undefined"==typeof e&&(e=10);for(var n,i,a,u,s,c=new t._support.CanvasImage(r),v=c.getImageData(),f=v.data,p=c.getPixelCount(),l=[],h=0;p>h;h+=e)n=4*h,i=f[n+0],a=f[n+1],u=f[n+2],s=f[n+3],s>=125&&(i>250&&a>250&&u>250||l.push([i,a,u]));var g=t.algorithms.quantize(l,o),d=g.palette();return c.removeCanvas(),d},t.video.color.dominantColor=function(r,o){var e=t.video.color.colorPalette(r,5,o),n=e[0];return n},"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports&&(module.exports=t),this.oo=t}();