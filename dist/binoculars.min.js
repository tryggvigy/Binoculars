!function(){function o(){var o=765,r=7,t=o/r;return{MAX_BRIGHTNESS:765,VERY_DARK:1*t,DARK:2*t,BRIGHT:3*t,VERY_BRIGHT:4*t}}var r={version:"0.0.1"};r._support={},r._support.toColorObj=function(o){var r={};return r.r=o[0],r.g=o[1],r.b=o[2],r},r._support.CanvasImage=function(o){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=o.width,this.height=this.canvas.height=o.height,this.context.drawImage(o,0,0,this.width,this.height)},r._support.CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},r._support.CanvasImage.prototype.update=function(o){this.context.putImageData(o,0,0)},r._support.CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},r._support.CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},r._support.CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)},r.algorithms={},r.algorithms.quantize=function(o,r){if(!t)var t={map:function(o,r){var t={};return r?o.map(function(o,e){return t.index=e,r.call(t,o)}):o.slice()},naturalOrder:function(o,r){return r>o?-1:o>r?1:0},sum:function(o,r){var t={};return o.reduce(r?function(o,e,n){return t.index=n,o+r.call(t,e)}:function(o,r){return o+r},0)},max:function(o,r){return Math.max.apply(null,r?t.map(o,r):o)}};var e=function(){function o(o,r,t){return(o<<2*c)+(r<<c)+t}function r(o){function r(){t.sort(o),e=!0}var t=[],e=!1;return{push:function(o){t.push(o),e=!1},peek:function(o){return e||r(),void 0===o&&(o=t.length-1),t[o]},pop:function(){return e||r(),t.pop()},size:function(){return t.length},map:function(o){return t.map(o)},debug:function(){return e||r(),t}}}function e(o,r,t,e,n,i,a){var u=this;u.r1=o,u.r2=r,u.g1=t,u.g2=e,u.b1=n,u.b2=i,u.histo=a}function n(){this.vboxes=new r(function(o,r){return t.naturalOrder(o.vbox.count()*o.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function i(r){var t,e,n,i,a=1<<3*c,u=new Array(a);return r.forEach(function(r){e=r[0]>>v,n=r[1]>>v,i=r[2]>>v,t=o(e,n,i),u[t]=(u[t]||0)+1}),u}function a(o,r){var t,n,i,a=1e6,u=0,s=1e6,c=0,f=1e6,p=0;return o.forEach(function(o){t=o[0]>>v,n=o[1]>>v,i=o[2]>>v,a>t?a=t:t>u&&(u=t),s>n?s=n:n>c&&(c=n),f>i?f=i:i>p&&(p=i)}),new e(a,u,s,c,f,p,r)}function u(r,e){function n(o){var r,t,n,i,a,u=o+"1",s=o+"2",v=0;for(c=e[u];c<=e[s];c++)if(g[c]>h/2){for(n=e.copy(),i=e.copy(),r=c-e[u],t=e[s]-c,a=t>=r?Math.min(e[s]-1,~~(c+t/2)):Math.max(e[u],~~(c-1-r/2));!g[a];)a++;for(v=d[a];!v&&g[a-1];)v=d[--a];return n[s]=a,i[u]=n[s]+1,[n,i]}}if(e.count()){var i=e.r2-e.r1+1,a=e.g2-e.g1+1,u=e.b2-e.b1+1,s=t.max([i,a,u]);if(1==e.count())return[e.copy()];var c,v,f,p,l,h=0,g=[],d=[];if(s==i)for(c=e.r1;c<=e.r2;c++){for(p=0,v=e.g1;v<=e.g2;v++)for(f=e.b1;f<=e.b2;f++)l=o(c,v,f),p+=r[l]||0;h+=p,g[c]=h}else if(s==a)for(c=e.g1;c<=e.g2;c++){for(p=0,v=e.r1;v<=e.r2;v++)for(f=e.b1;f<=e.b2;f++)l=o(v,c,f),p+=r[l]||0;h+=p,g[c]=h}else for(c=e.b1;c<=e.b2;c++){for(p=0,v=e.r1;v<=e.r2;v++)for(f=e.g1;f<=e.g2;f++)l=o(v,f,c),p+=r[l]||0;h+=p,g[c]=h}return g.forEach(function(o,r){d[r]=h-o}),n(s==i?"r":s==a?"g":"b")}}function s(o,e){function s(o,r){for(var t,e=1,n=0;f>n;)if(t=o.pop(),t.count()){var i=u(c,t),a=i[0],s=i[1];if(!a)return;if(o.push(a),s&&(o.push(s),e++),e>=r)return;if(n++>f)return}else o.push(t),n++}if(!o.length||2>e||e>256)return!1;var c=i(o),v=0;c.forEach(function(){v++});var l=a(o,c),h=new r(function(o,r){return t.naturalOrder(o.count(),r.count())});h.push(l),s(h,p*e);for(var g=new r(function(o,r){return t.naturalOrder(o.count()*o.volume(),r.count()*r.volume())});h.size();)g.push(h.pop());s(g,e-g.size());for(var d=new n;g.size();)d.push(g.pop());return d}var c=5,v=8-c,f=1e3,p=.75;return e.prototype={volume:function(o){var r=this;return(!r._volume||o)&&(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(r){var t=this,e=t.histo;if(!t._count_set||r){var n,i,a,u=0;for(n=t.r1;n<=t.r2;n++)for(i=t.g1;i<=t.g2;i++)for(a=t.b1;a<=t.b2;a++)index=o(n,i,a),u+=e[index]||0;t._count=u,t._count_set=!0}return t._count},copy:function(){var o=this;return new e(o.r1,o.r2,o.g1,o.g2,o.b1,o.b2,o.histo)},avg:function(r){var t=this,e=t.histo;if(!t._avg||r){var n,i,a,u,s,v=0,f=1<<8-c,p=0,l=0,h=0;for(i=t.r1;i<=t.r2;i++)for(a=t.g1;a<=t.g2;a++)for(u=t.b1;u<=t.b2;u++)s=o(i,a,u),n=e[s]||0,v+=n,p+=n*(i+.5)*f,l+=n*(a+.5)*f,h+=n*(u+.5)*f;t._avg=v?[~~(p/v),~~(l/v),~~(h/v)]:[~~(f*(t.r1+t.r2+1)/2),~~(f*(t.g1+t.g2+1)/2),~~(f*(t.b1+t.b2+1)/2)]}return t._avg},contains:function(o){var r=this,t=o[0]>>v;return gval=o[1]>>v,bval=o[2]>>v,t>=r.r1&&t<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},n.prototype={push:function(o){this.vboxes.push({vbox:o,color:o.avg()})},palette:function(){return this.vboxes.map(function(o){return o.color})},size:function(){return this.vboxes.size()},map:function(o){for(var r=this.vboxes,t=0;t<r.size();t++)if(r.peek(t).vbox.contains(o))return r.peek(t).color;return this.nearest(o)},nearest:function(o){for(var r,t,e,n=this.vboxes,i=0;i<n.size();i++)t=Math.sqrt(Math.pow(o[0]-n.peek(i).color[0],2)+Math.pow(o[1]-n.peek(i).color[1],2)+Math.pow(o[2]-n.peek(i).color[2],2)),(r>t||void 0===r)&&(r=t,e=n.peek(i).color);return e},forcebw:function(){var o=this.vboxes;o.sort(function(o,r){return t.naturalOrder(t.sum(o.color),t.sum(r.color))});var r=o[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(o[0].color=[0,0,0]);var e=o.length-1,n=o[e].color;n[0]>251&&n[1]>251&&n[2]>251&&(o[e].color=[255,255,255])}},{quantize:s}}();return e.quantize(o,r)},r.video={},r.video._hasPermission=!1,r.video._listenerQueue=[],r.video.onPermission=function(o){r.video._hasPermission?o.call():r.video._listenerQueue.push(o)},r.video.gotPermission=function(){window.setTimeout(function(){if(r.video._hasPermission=!0,r.video._listenerQueue){for(var o,t=0;o=r.video._listenerQueue[t++];)o.call();r.video._listenerQueue=null}},1e3)},r.video.register=function(o){var t=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)};if(!t())throw new Error("init(): Sorry, your browser does not support this behaviour");var e={video:!0},n=function(o){console.error("Video capture error: ",o)};navigator.getUserMedia?navigator.getUserMedia(e,function(t){o.src=t,o.play(),r.video.gotPermission()},n):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e,function(t){o.src=window.webkitURL.createObjectURL(t),o.play(),r.video.gotPermission()},n):navigator.mozGetUserMedia&&navigator.mozGetUserMedia(e,function(t){o.src=window.URL.createObjectURL(t),o.play(),r.video.gotPermission()},n)},r.video.isVeryDark=function(t){var e=o(),n=r.video.color.dominantColor(t);n=r._support.toColorObj(n);var i=n.r+n.g+n.b;return i<=e.VERY_DARK?!0:!1},r.video.isDark=function(t){var e=o(),n=r.video.color.dominantColor(t);n=r._support.toColorObj(n);var i=n.r+n.g+n.b;return i>e.VERY_DARK&&i<=e.DARK?!0:!1},r.video.isBright=function(t){var e=o(),n=r.video.color.dominantColor(t);n=r._support.toColorObj(n);var i=n.r+n.g+n.b;return i>=e.DARK&&i<e.BRIGHT?!0:!1},r.video.isVeryBright=function(t){var e=o(),n=r.video.color.dominantColor(t);n=r._support.toColorObj(n);var i=n.r+n.g+n.b;return i>=e.BRIGHT?!0:!1},r.video.getBrightness=function(t){var e=o(),n=r.video.color.dominantColor(t,5);n=r._support.toColorObj(n);var i=n.r+n.g+n.b;return i/e.MAX_BRIGHTNESS},r.video.getPixels=function(o){var t=new r._support.CanvasImage(o),e=t.getImageData(),n=e.data;return t.removeCanvas(),n},r.video.getPixelCount=function(o){var t=new r._support.CanvasImage(o);return t.removeCanvas(),t.getPixelCount()},r.video.color={},r.video.color.colorPalette=function(o,t,e){"undefined"==typeof t&&(t=10),"undefined"==typeof e&&(e=10);for(var n,i,a,u,s,c=new r._support.CanvasImage(o),v=c.getImageData(),f=v.data,p=c.getPixelCount(),l=[],h=0;p>h;h+=e)n=4*h,i=f[n+0],a=f[n+1],u=f[n+2],s=f[n+3],s>=125&&(i>250&&a>250&&u>250||l.push([i,a,u]));var g=r.algorithms.quantize(l,t),d=g.palette();return c.removeCanvas(),d},r.video.color.dominantColor=function(o,t){var e=r.video.color.colorPalette(o,5,t),n=e[0];return n},"function"==typeof define&&define.amd?define(r):"object"==typeof module&&module.exports&&(module.exports=r),this.oo=r}();